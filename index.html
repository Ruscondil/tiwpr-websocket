<!DOCTYPE html>
<html>

<head>
    <title>Room Creator</title>
</head>

<body>
    <div id="roomCreator">
        <h1>Room Creator</h1>
        <input id="roomNameCreator" type="text" placeholder="Enter room name">
        <button id="createRoom">Create Room</button>
        <h2>Rooms</h2>
        <ul id="roomList"></ul>
    </div>
    <div id="roomView" style="display: none;">
        <div>
            <h1>Room</h1>
            <h2 id="roomNameView">Room name goes here</h2>
            <p id="players">Players go here</p>
            <button id="daleteRoom" style="display: none;">Delete room</button>
            <button id="startGameButton" style="display: none;">Start Game</button>
        </div>
    </div>
    <div id="gameView" style="display: none;">
        <div>
            <h1>Game</h1>
            <p id="wordProgress">Word: </p>
            <p id="wrongLetters">Wrong letters: </p>

            <div id="letters" style="display: none;">
                <input id="letterInput" type="text" placeholder="Enter letter" maxlength="1">
                <button id="sendLetter">Send</button>
            </div>
            <p id="waitTurn">Wait for your turn</p>
            <canvas id="hangmanCanvas" width="200" height="200" style="border:1px solid #d3d3d3;">
                Your browser does not support the HTML canvas tag.
            </canvas>


        </div>
    </div>

    <script>
        var socket = new WebSocket("ws://localhost:8765");
        var roomList = document.getElementById('roomList');

        document.getElementById('createRoom').addEventListener('click', function () {
            var roomName = document.getElementById('roomNameCreator').value;
            socket.send(JSON.stringify({ action: 'create_room', room_name: roomName }));
        });

        document.getElementById('startGameButton').addEventListener('click', function () {
            var roomName = document.getElementById('roomNameView').value; //TODO może jakoś sprytniej to zrobić
            socket.send(JSON.stringify({ action: 'start_game', room_name: roomName }));
        });

        document.getElementById('daleteRoom').addEventListener('click', function () {
            var roomName = document.getElementById('roomNameView').value; //TODO może jakoś sprytniej to zrobić
            socket.send(JSON.stringify({ action: 'daleteRoom', room_name: roomName }));
        });

        document.getElementById('sendLetter').addEventListener('click', function () {
            var roomName = document.getElementById('roomNameView').value; //TODO może jakoś sprytniej to zrobić
            var letter = document.getElementById('letterInput').value; // Get the value of letterInput
            socket.send(JSON.stringify({ action: 'guess_letter', room_name: roomName, letter: letter })); // Send the letter as part of the payload
            document.getElementById('letterInput').value = ''; // Clear the value of letterInput
        });


        socket.onmessage = function (event) {
            var data = JSON.parse(event.data);
            if (data.action === 'can_start_game') {  // If the server sends a start_game action
                document.getElementById('startGameButton').style.display = 'block';  // Show the Start Game button
            } else if (data.message === 'Waiting for start of the game') {  // If the server sends a waiting message
                roomList.innerHTML = 'Waiting for start of the game';  // Display the waiting message
            } else if (data.action === 'Room info') {
                roomList.innerHTML = '';
                for (var room in data.rooms) {
                    var listItem = document.createElement('li');
                    listItem.textContent = room + ': ' + data.rooms[room] + ' players';

                    var joinButton = document.createElement('button');
                    joinButton.textContent = 'Join';
                    joinButton.addEventListener('click', function () {
                        socket.send(JSON.stringify({ action: 'join_room', room_name: room }));
                    });

                    listItem.appendChild(joinButton);
                    roomList.appendChild(listItem);
                }
            } else if (data.action === 'Joined_RoomInfo') {
                document.getElementById('roomCreator').style.display = 'none';
                document.getElementById('roomView').style.display = 'block';
                document.getElementById('roomNameView').textContent = 'Room name: ' + data.room_name;
                document.getElementById('players').textContent = data.players + '/' + data.max_players + ' players';
            } else if (data.action === 'UpdateJoinedRoomInfo') {
                document.getElementById('players').textContent = data.players + '/' + data.max_players + ' players';
            } else if (data.action === 'StartGame') {
                document.getElementById('roomView').style.display = 'none';
                document.getElementById('gameView').style.display = 'block';
                document.getElementById('wordProgress').textContent = 'Word: ' + data.wordProgress;
                document.getElementById('letterInput').style.display = 'block';
                drawHangman(0)
            } else if (data.action === 'UpdateWordProgress') {
                document.getElementById('wordProgress').textContent = 'Word: ' + data.wordProgress;
            } else if (data.action === 'UpdateWrongLetters') {
                document.getElementById('wrongLetters').textContent = 'Wrong letters: ' + data.wrongLetters;
                drawHangman(data.errors);
            } else if (data.action === 'YourTurn') {
                document.getElementById('waitTurn').style.display = 'none';
                document.getElementById('letters').style.display = 'block';
            } else if (data.action === 'WaitTurn') {
                document.getElementById('waitTurn').style.display = 'block';
                document.getElementById('letters').style.display = 'none';
            }
            else if (data.action === 'GameOver') {
                document.getElementById('gameView').style.display = 'none';
                document.getElementById('roomView').style.display = 'block';
                document.getElementById('players').textContent = data.players + '/' + data.max_players + ' players';
                document.getElementById('startGameButton').style.display = 'none';
                document.getElementById('daleteRoom').style.display = 'block';
            }
            else if (data.message) {
                alert(data.message);
            }

            socket.onopen = function (event) {
                socket.send(JSON.stringify({ action: 'get_rooms' }));
            };
        };

        function drawHangman(errors) {
            var c = document.getElementById("hangmanCanvas");
            var ctx = c.getContext("2d");

            ctx.beginPath();
            // Draw the gallows
            ctx.moveTo(50, 180);
            ctx.lineTo(150, 180);
            ctx.moveTo(100, 180);
            ctx.lineTo(100, 50);
            ctx.lineTo(150, 50);
            ctx.lineTo(150, 70);

            if (errors > 0) {
                // Draw the head
                ctx.arc(150, 90, 20, 0, 2 * Math.PI);
            }
            if (errors > 1) {
                // Draw the body
                ctx.moveTo(150, 110);
                ctx.lineTo(150, 140);
            }
            if (errors > 2) {
                // Draw the first arm
                ctx.moveTo(150, 120);
                ctx.lineTo(130, 110);
            }
            if (errors > 3) {
                // Draw the second arm
                ctx.moveTo(150, 120);
                ctx.lineTo(170, 110);
            }
            if (errors > 4) {
                // Draw the first leg
                ctx.moveTo(150, 140);
                ctx.lineTo(130, 160);
            }
            if (errors > 5) {
                // Draw the second leg
                ctx.moveTo(150, 140);
                ctx.lineTo(170, 160);
            }

            ctx.stroke();
        }
    </script>
</body>

</html>